{% extends "page.html" %}

{% block stylesheet %}
{{ super() }}
<style>
    .stop-container {
        min-height: calc(100vh - 100px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 2rem;
    }

    .stop-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 3rem;
        max-width: 450px;
        width: 100%;
    }

    .spinner-container {
        margin-bottom: 2rem;
    }

    .spinner {
        width: 80px;
        height: 80px;
        position: relative;
        margin: 0 auto;
    }

    .spinner-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 3px solid transparent;
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
    }

    .spinner-ring:nth-child(1) {
        border-top-color: var(--accent-orange);
        animation-delay: 0s;
    }

    .spinner-ring:nth-child(2) {
        width: 70%;
        height: 70%;
        top: 15%;
        left: 15%;
        border-right-color: var(--accent-red);
        animation-delay: 0.1s;
        animation-direction: reverse;
    }

    .spinner-ring:nth-child(3) {
        width: 40%;
        height: 40%;
        top: 30%;
        left: 30%;
        border-bottom-color: var(--accent-orange);
        animation-delay: 0.2s;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .stop-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .stop-message {
        color: var(--text-secondary);
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .stop-progress {
        margin-top: 1.5rem;
    }

    #progress-message {
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .progress-log {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        max-height: 200px;
        overflow-y: auto;
        text-align: left;
        color: var(--text-secondary);
    }

    .btn-cancel {
        margin-top: 1.5rem;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 0.5rem 1.5rem;
        font-size: 0.9rem;
        border-radius: 6px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        transition: all 0.2s;
    }

    .btn-cancel:hover {
        border-color: var(--accent-blue);
        color: var(--accent-blue);
    }
</style>
{% endblock %}

{% block main %}
<div class="stop-container">
    <div class="stop-card">
        <div class="spinner-container">
            <div class="spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
        </div>
        
        <h1 class="stop-title">Parando o Servidor</h1>
        <p class="stop-message">
            Aguarde enquanto seu servidor est√° sendo desligado...
        </p>
        
        <div class="stop-progress">
            <p id="progress-message">Salvando trabalho e liberando recursos...</p>
            <div class="progress-log" id="progress-log">
                <pre id="progress-log-content"></pre>
            </div>
        </div>
    </div>
</div>

{% if cancel_url %}
<script type="text/javascript">
var progress_url = "{{ progress_url }}";

if (progress_url) {
    var event_source = new EventSource(progress_url);

    event_source.onmessage = function(e) {
        var data = JSON.parse(e.data);
        
        if (data.ready) {
            event_source.close();
            window.location.href = "/hub/home";
            return;
        }
        
        if (data.message) {
            document.getElementById('progress-message').textContent = data.message;
        }
        
        if (data.progress) {
            var log = document.getElementById('progress-log-content');
            var logContainer = document.getElementById('progress-log');
            log.textContent += data.progress + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }
    };

    event_source.onerror = function(e) {
        console.log('EventSource error:', e);
    };
}
</script>
{% endif %}
{% endblock %}
